FROM node:22-alpine

# Accept build arguments for user/group IDs
ARG USER_ID=1000
ARG GROUP_ID=1000

WORKDIR /app

# Install pnpm
RUN npm install -g pnpm

# Copy package files and install dependencies as root first
COPY package*.json ./
RUN pnpm install

# Copy application files
COPY . .

# Change ownership of the app directory to the node user (UID/GID 1000)
RUN chown -R node:node /app

# Switch to node user
USER node

EXPOSE 5173

CMD ["pnpm", "dev", "--", "--host"]
