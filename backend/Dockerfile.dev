FROM node:22-alpine AS base

# Accept build arguments for user/group IDs
ARG USER_ID=1000
ARG GROUP_ID=1000

WORKDIR /app

# Copy package files and install dependencies as root first
COPY package*.json ./
RUN npm install

# Install dev tools (ts-node-dev for hot reload)
RUN npm install --only=dev

# Copy application files
COPY . .

# Change ownership of the app directory to the node user (UID/GID 1000)
RUN chown -R node:node /app

# Switch to node user
USER node

EXPOSE 5000

CMD ["npm", "run", "dev"]
